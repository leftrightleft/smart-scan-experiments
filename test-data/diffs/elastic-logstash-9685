diff --git a/Gemfile.template b/Gemfile.template
index 8ae1cbde5de..18bd155d50f 100644
--- a/Gemfile.template
+++ b/Gemfile.template
@@ -25,6 +25,7 @@ gem "belzebuth", :group => :development
 gem "pleaserun", "~>0.0.28"
 gem 'webrick', '~> 1.3.1'
 gem "atomic", "<= 1.1.99"
+gem "rake", "~> 12.2.1", :group => :build
 gem "logstash-codec-cef"
 gem "logstash-codec-collectd"
 gem "logstash-codec-dots"
diff --git a/ci/acceptance_tests.sh b/ci/acceptance_tests.sh
index 1dd6627927e..c74208781e3 100755
--- a/ci/acceptance_tests.sh
+++ b/ci/acceptance_tests.sh
@@ -6,7 +6,7 @@ set -x
 # uses at least 1g of memory, If we don't do this we can get OOM issues when
 # installing gems. See https://github.com/elastic/logstash/issues/5179
 export JRUBY_OPTS="-J-Xmx1g"
-export GRADLE_OPTS="-Xmx2g -Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info"
+export GRADLE_OPTS="-Xmx2g -Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info -Dfile.encoding=UTF-8"
 export OSS=true
 
 SELECTED_TEST_SUITE=$1
diff --git a/ci/integration_tests.sh b/ci/integration_tests.sh
index 0d2a3a2b398..4954d4420f1 100755
--- a/ci/integration_tests.sh
+++ b/ci/integration_tests.sh
@@ -5,7 +5,7 @@
 # uses at least 1g of memory, If we don't do this we can get OOM issues when
 # installing gems. See https://github.com/elastic/logstash/issues/5179
 export JRUBY_OPTS="-J-Xmx1g"
-export GRADLE_OPTS="-Xmx2g -Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info"
+export GRADLE_OPTS="-Xmx2g -Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info -Dfile.encoding=UTF-8"
 
 export SPEC_OPTS="--order rand --format documentation"
 export CI=true
diff --git a/ci/license_check.sh b/ci/license_check.sh
index 4c4da5314d4..f9632ecba43 100755
--- a/ci/license_check.sh
+++ b/ci/license_check.sh
@@ -1,5 +1,5 @@
 #!/bin/bash -i
-export GRADLE_OPTS="-Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info"
+export GRADLE_OPTS="-Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info -Dfile.encoding=UTF-8"
 
 ./gradlew installDefaultGems
 bin/dependencies-report --csv report.csv
diff --git a/ci/unit_tests.sh b/ci/unit_tests.sh
index 48a375c40f3..ae0ad59210a 100755
--- a/ci/unit_tests.sh
+++ b/ci/unit_tests.sh
@@ -5,7 +5,7 @@
 # uses at least 1g of memory, If we don't do this we can get OOM issues when
 # installing gems. See https://github.com/elastic/logstash/issues/5179
 export JRUBY_OPTS="-J-Xmx1g"
-export GRADLE_OPTS="-Xmx2g -Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info"
+export GRADLE_OPTS="-Xmx2g -Dorg.gradle.daemon=false -Dorg.gradle.logging.level=info -Dfile.encoding=UTF-8"
 
 export SPEC_OPTS="--order rand --format documentation"
 export CI=true
